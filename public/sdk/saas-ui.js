var CP_InputCreate=function(e,t,n,o,u,c,i){function l(){h&&(clearInterval(h),h=null),m&&(clearTimeout(m),m=null),y&&(clearTimeout(y),y=null)}function _(e,t,n){if(!Cloudplay.isStoped()&&!Cloudplay.isReconnecting()){if(Cloudplay.sendCountly(countly_event_id_map.input_socket_connecting),n>=i)return Cloudplay.sendCountly(countly_event_id_map.input_socket_connect_failed),void p.emit("cp.reconnect",1);l(),v=new WebSocket(e,t);var o=!1,a=v;v.onopen=function(){return a!=v?void Cloudplay.sendCountly(countly_event_id_map.input_socket_check_failed,"onopen"):(Cloudplay.sendCountly(countly_event_id_map.input_socket_connect_opend),o=!0,void(h=setInterval(function(){var e="ping:"+Date.now();CP_UTILS.websocket_send(v,e)},u||6e4)))},v.onmessage=function(e){if(a!=v)return void Cloudplay.sendCountly(countly_event_id_map.input_socket_check_failed,"onmessage");var t=e.data;";"==t.charAt(t.length-1)&&(t=t.substr(0,t.length-1));var n=null,o=t.indexOf(":");switch(n=o>=0?t.substr(0,o).toLowerCase():t.toLowerCase()){case"pong":var u=Date.now(),i=t.substr(o+1),l=u-i;Cloudplay.sendCountly(countly_event_id_map.input_socket_ping_pong_delay_time,l),l>=c&&Cloudplay.sendCountly(countly_event_id_map.input_socket_ping_pong_delay_max,l);break;case"startIM".toLowerCase():Cloudplay.sendCountly(countly_event_id_map.input_socket_start_im);var _=t.indexOf(",");if(_==-1||_<o)break;var r=parseFloat(t.substr(o+1,_-(o+1))),s=parseFloat(t.substr(_+1));p.emit("cp.start_im",r,s);break;case"stopIM".toLowerCase():Cloudplay.sendCountly(countly_event_id_map.input_socket_stop_im),p.emit("cp.stop_im")}},v.onclose=function(u){if(a!=v)return void Cloudplay.sendCountly(countly_event_id_map.input_socket_check_failed,"onclose");var c=u&&u.code?u.code:-1;return Cloudplay.sendCountly(countly_event_id_map.input_socket_connect_closed,c),r(),o?void(y=setTimeout(function(){__hmLogWarn(null,CP_ERROR_MAP.input_socket_close_and_refresh_token),p.emit("cp.reconnect",1)},3e3)):void(m=setTimeout(function(){_(e,t,n+1)},3e3))}}}function a(){return v?void __hmLogError(null,CP_ERROR_MAP.input_socket_connect_multi_time):void _(n,o,0)}function r(){l(),CP_UTILS.websocket_close(v,!1),v=null,p.emit("cp.stop_im"),d()}function s(e){if(d(),f=document.getElementById(e),!f)return void __hmLogError(null,CP_ERROR_MAP.js_player_object_not_found);var t=f.getBoundingClientRect();g.x=t.left,g.y=t.top,g.width=t.right-t.left,g.height=t.bottom-t.top,f.addEventListener("touchstart",P,C),f.addEventListener("touchmove",I,C),f.addEventListener("touchend",R,C),f.addEventListener("touchcancel",x,C)}function d(){f&&(f.removeEventListener("touchstart",P,C),f.removeEventListener("touchmove",I,C),f.removeEventListener("touchend",R,C),f.removeEventListener("touchcancel",x,C),f=null)}var p=e,v=null,h=null,m=null,y=null,f=null,C=!0,g={x:0,y:0,width:0,height:0},k=1,L=2,w=3,E=function(e){var t=e-g.x;return t<0&&(t=0),t>g.width&&(t=g.width),(t/g.width).toFixed(4)},b=function(e){var t=e-g.y;return t<0&&(t=0),t>g.height&&(t=g.height),(t/g.height).toFixed(4)},T=function(e,t,n){e.preventDefault(),e.stopPropagation();for(var o=0;o<e.changedTouches.length;o++){var u=e.changedTouches[o],c=E(u.clientX),i=b(u.clientY),l=c;c=i,i=1-l,window.CP_ENABLE_DEBUG;var _="mouse:"+t+":"+c+","+i;CP_UTILS.websocket_send(v,_)}},P=function(e){T(e,k,"_onTouchStart")},I=function(e){T(e,w,"_onTouchMove")},R=function(e){T(e,L,"_onTouchEnd")},x=function(e){T(e,L,"_onTouchCancel")};return{connectSocket:a,close:function(){r()},startInputListener:s,stopInputListener:d}};
var CP_CloudplayUIInit=function(t){function n(){var e=CP_UTILS.getSessionStore("game_options");return e&&e.isPortrait}function i(e){e.preventDefault()}function o(e,n){if(t(e).length>1)return __hmLogWarn(null,CP_ERROR_MAP.multi_player),!1;if(t(e).length<=0)return __hmLogError(null,CP_ERROR_MAP.no_player_wrap),!1;M=e,b=n,t(M).on("contextmenu",function(e){e.preventDefault()});var i=null;return i=y?{containerId:t(M).attr("id"),width:N.width,height:N.height,videoUrl:"ws://"+N.ip+":"+N.videoPort+"/",audioUrl:"ws://"+N.ip+":"+N.audioPort,isPortraitGame:N.isPortraitGame}:{containerId:t(M).attr("id"),width:n.vedioWidth,height:n.vedioHeight,videoUrl:n.videoUrl,audioUrl:n.audioUrl,isPortraitGame:W},(k=CP_JsPlayerInit(w,i))?(k.start(),D.startInputListener(k.id()),!0):void w.emit(CP_CONSTANT.EVENT_STOP_SDK,"创建播放器失败")}function a(e,t,n,i){U=t,R=n,O=i}function s(e){Cloudplay.sendCountly(countly_event_id_map.start_revolution),w.emit("cp.sceneChanged","play",{cur_rate:-1}),o(M,e)}function l(e){k&&k.stop(!0),k=null,D&&(D.close(),D=null)}function r(){return k&&k.isPlaying()}function d(){return-1}function c(){return!1}function _(e,t,n){}function u(e,t){D&&(D.close(),D=null);var n=e;y&&(n="ws://"+N.ip+":"+N.inputPort+"/testingBackDoor"),D=CP_InputCreate(w,W,n,t,O.ping_interval_time,O.ping_delay_time,3),D.connectSocket()}function p(e){this.stopPlay(!1),T(!1),e&&v(CP_CONSTANT.UI_MESSAGE_TYPE_SYSTEM,e)}function m(){}function h(){function e(){null!==k&&k.playAudio()}if(void 0!=O.floating_app_name){t(".floatingBar").length>0&&t(".floatingBar").remove();var n="_aLink";CP_UTILS.isInWeixin()&&(n="_download");var i="longname";W&&(i="");var o="pause";null!==k&&k.isAudioPlaying()&&(o="");var a='<div id="audioPlayingBtn" class="music '+o+'">                <span class="start-btn"><img src="'+Y+'/music@2x.png" alt="" /></span>                <span class="pause-btn"></span>            </div>';html='<div class="floatingBar">                    <div class="time">                        <p class="img"><img src="'+Y+'/timeing.png"  /></p>                        <p class="text"><span class="countdownNumber" ></span>秒</p>                    </div>                    '+a+'                    <span class="game-img"><img src="'+O.floating_icon_url+'" alt="" /></span>                    <span class="game-name '+i+'">'+O.floating_app_name+'</span>                    <span class="game-btn">                        <a class="ios '+n+'" target="_blank" href="'+O.floating_app_url+'"><img src="'+Y+'/ios.png" alt="" /></a>                        <a class="android '+n+'" target="_blank" href="'+O.floating_app_url+'"><img src="'+Y+'/android.png" alt="" /></a>                    </span>                </div>',W||!CP_UTILS.isSupportDevice()?(t("#playGameBox").append(html),CP_UTILS.isSupportDevice()||T(!1)):t(M).append(html);var s=document.getElementById("audioPlayingBtn");if(s.addEventListener("touchend",e,!0),CP_UTILS.isSupportDevice()&&null!=b&&b.remindTime!=-1){var l;b&&null!=b.remindTime&&"null"!=b.remindTime&&(l=Math.round(b.remindTime/1e3),C(l))}else P()}}function g(){t(".floatingBar").remove()}function C(e){x!=-1&&clearInterval(x),e>999&&P(),x=setInterval(function(){e>=1?(e--,t(".countdownNumber").html(e),e<=999&&t(".floatingBar > .time").css({display:"block"})):T(!0)},1e3)}function P(){t(".floatingBar > .time").css({display:"none"})}function T(e){x!=-1&&(clearInterval(x),x=-1,t("#audioPlayingBtn").addClass("pause"),P(),e&&w.emit(CP_CONSTANT.EVENT_STOP_SDK,U.prompt_game_over))}function E(e,n){var i="",o="",a="",s="";switch(t(".LockScreen").remove(),e){case CP_CONSTANT.UI_MESSAGE_TYPE_PORTRAIT:i="portrait",o="在竖屏下锁定屏幕<br>并竖屏游戏",s="LockScreen";break;case CP_CONSTANT.UI_MESSAGE_TYPE_LANDSCAPE:i="landscape",o="在竖屏下锁定屏幕<br>并横屏游戏",s="LockScreen";break;case CP_CONSTANT.UI_MESSAGE_TYPE_IOSWECHAT:s=V,a="iosWeChat",o='<img width="200" src="'+Y+'/ios-wechat.png" alt="" />';break;case CP_CONSTANT.UI_MESSAGE_TYPE_ANDROIDWECHAT:s=V,a="androidWeChat",o='<img width="200" src="'+Y+'/Android-wechat.png" alt="" />'}var l='<div class="backgroundCover '+s+'">                    <a class="bgUpInfomationBox '+a+'">                         <i class="'+i+'"></i>                         <p class="p2">'+o+"</p>                    </a>                </div>";t("#playGameBox").append(l);var r=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,d=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;if(!CP_UTILS.isInWeixin()||"portrait"!=i&&"landscape"!=i?t(".backgroundCover").css({width:r,height:d}):t(".backgroundCover").css({width:d+64,height:r}),s===V){var c={title:"download",url:"#"};window.history.pushState(c,"title","#")}}function S(){t(".LockScreen").remove()}function v(e,n){var i="",o="",a="";switch(h(),T(),e){case CP_CONSTANT.UI_MESSAGE_TYPE_UNSUPPORT:i="unsupported",o="您的设备暂不支持",a="systemUnsupported";break;case CP_CONSTANT.UI_MESSAGE_TYPE_SYSTEM:i="system",o=n,a="systemInfo";break;case CP_CONSTANT.UI_MESSAGE_TYPE_REFRESH_REQUIRED:i="system",o=n,a="systemInfo refreshPage"}t(".systemInfo").remove(),Cloudplay.sendCountly(countly_event_id_map.show_info_page,o?encodeURIComponent(o):"");var s='<div class="backgroundCover '+a+'">                    <a class="bgUpInfomationBox">                         <i class="'+i+'"></i>                         <p class="p2">'+o+"</p>                    </a>                </div>",l=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,r=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;W?(t("#playGameBox").append(s),t("#playGameBox .backgroundCover").css({width:l,height:r})):(t(M).append(s),"been_ready"==B?t("#playGameBox .backgroundCover").css({width:r,height:l}):t("#playGameBox .backgroundCover").css({width:l,height:r})),e==CP_CONSTANT.UI_MESSAGE_TYPE_REFRESH_REQUIRED&&t(".refreshPage").on("touchend",function(){window.location.reload()})}function I(){t("."+H).remove()}function f(){t("."+V).remove()}function A(e){w.emit("cp.get_notice",L,e)}var N={ip:"172.16.40.218",videoPort:9911,audioPort:7766,inputPort:7681,width:720,height:404,isPortraitGame:!1},y=!1,w=Cloudplay.eventEmitter();w||__hmLogError(null,CP_ERROR_MAP.eventEmitterIsNull);var U={},R={},O={},L=1,b=null,k=null,D=null,B="",G=CP_UTILS.getBasePath("saas-sdk.js");G||(G=CP_UTILS.getBasePath("cloudplay.js"));var Y=G+"images",M=function(){document.getElementById(CP_CONSTANT.UI_PLAYER_CONTAINER_ID)||__hmLogError(null,CP_ERROR_MAP.player_container_not_exist);var e='<div class="'+CP_CONSTANT.UI_PLAYER_DIV_CLASS+'" id="'+CP_CONSTANT.UI_PLAYER_DIV_ID+'"></div>';return t("#"+CP_CONSTANT.UI_PLAYER_CONTAINER_ID).append(e),"."+CP_CONSTANT.UI_PLAYER_DIV_CLASS}(),W=n();document.getElementById(CP_CONSTANT.UI_PLAYER_CONTAINER_ID).addEventListener("touchmove",i,!0),w.on("cp.get_notice",function(e,t){});var x=-1,H="messageView",V="downloadView";return w.on(CP_CONSTANT.EVENT_ORIENTATION_CHANGE,function(e){if("landscape"==e)E(W?CP_CONSTANT.UI_MESSAGE_TYPE_PORTRAIT:CP_CONSTANT.UI_MESSAGE_TYPE_LANDSCAPE);else{S();var n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;t("."+V).length>0?t("."+V).css({width:i+52,height:n,left:0,top:0}):(t(".systemUnsupported").css({width:n,height:i,left:0,top:0}),W?CP_UTILS.isInWeixin()?t(".systemInfo").css({width:i,height:n,left:"20px",top:0}):t(".systemInfo").css({width:n,height:i,left:0,top:0}):CP_UTILS.isInWeixin()?t(".systemInfo").css({width:n,height:i,left:0,top:0}):t(".systemInfo").css({width:i,height:n,left:0,top:0}));var o=k.getCanvasInfo(),a=o.id;t("#"+a).length>0&&t("#"+a).css({left:o.style.left,top:o.style.top,width:o.style.width,height:o.style.height})}}),w.on(CP_CONSTANT.EVENT_PLAYER_READY,function(){h(),B="been_ready"}),w.on(CP_CONSTANT.EVENT_PLAYER_AUDIO_START_PLAYING,function(){t("#audioPlayingBtn").removeClass("pause")}),window.onpopstate=function(e){f()},t(document).on("click","._download",function(e){e.preventDefault(),E(CP_CONSTANT.UI_MESSAGE_TYPE_IOSWECHAT),Cloudplay.sendCountly(countly_event_id_map.click_download)}).on("click","._aLink",function(e){Cloudplay.sendCountly(countly_event_id_map.click_download)}).on("click","._downloadAndroid",function(){e.preventDefault(),E(CP_CONSTANT.UI_MESSAGE_TYPE_ANDROIDWECHAT),Cloudplay.sendCountly(countly_event_id_map.click_download)}),{setAuthData:a,startPlay:s,stopPlay:l,isPlayerRunning:r,curResId:d,isUserSelectedResMode:c,askQueuing:_,setCurrentResId:m,connectInputSocket:u,stop:p,showFloatBar:h,hideFloatBar:g,showMessageView:v,hideMessageView:I,showWarnToast:A}};