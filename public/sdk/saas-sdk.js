var SAAS_AUTH="https://saas-rel.haimawan.com/s/rest/api",envType="";window.CP_ENABLE_DEBUG=!1;
"use strict";function HM_Events(){}function EE(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function addListener(e,t,n,r,i){var s=new EE(n,r||e,i),o=prefix?prefix+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],s]:e._events[o].push(s):(e._events[o]=s,e._eventsCount++),e}function clearEvent(e,t){0===--e._eventsCount?e._events=new HM_Events:delete e._events[t]}function HM_EventEmitter(){this._events=new HM_Events,this._eventsCount=0}var has=Object.prototype.hasOwnProperty,prefix="~";Object.create&&(HM_Events.prototype=Object.create(null),(new HM_Events).__proto__||(prefix=!1)),HM_EventEmitter.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)has.call(e,t)&&n.push(prefix?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},HM_EventEmitter.prototype.listeners=function(e,t){var n=prefix?prefix+e:e,r=this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o},HM_EventEmitter.prototype.emit=function(e,t,n,r,i,s){var o=prefix?prefix+e:e;if(!this._events[o])return!1;var c,v,f=this._events[o],a=arguments.length;if(f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),a){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,t),!0;case 3:return f.fn.call(f.context,t,n),!0;case 4:return f.fn.call(f.context,t,n,r),!0;case 5:return f.fn.call(f.context,t,n,r,i),!0;case 6:return f.fn.call(f.context,t,n,r,i,s),!0}for(v=1,c=new Array(a-1);v<a;v++)c[v-1]=arguments[v];f.fn.apply(f.context,c)}else{var p,_=f.length;for(v=0;v<_;v++)switch(f[v].once&&this.removeListener(e,f[v].fn,void 0,!0),a){case 1:f[v].fn.call(f[v].context);break;case 2:f[v].fn.call(f[v].context,t);break;case 3:f[v].fn.call(f[v].context,t,n);break;case 4:f[v].fn.call(f[v].context,t,n,r);break;default:if(!c)for(p=1,c=new Array(a-1);p<a;p++)c[p-1]=arguments[p];f[v].fn.apply(f[v].context,c)}}return!0},HM_EventEmitter.prototype.on=function(e,t,n){return addListener(this,e,t,n,!1)},HM_EventEmitter.prototype.once=function(e,t,n){return addListener(this,e,t,n,!0)},HM_EventEmitter.prototype.removeListener=function(e,t,n,r){var i=prefix?prefix+e:e;if(!this._events[i])return this;if(!t)return clearEvent(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||r&&!s.once||n&&s.context!==n||clearEvent(this,i);else{for(var o=0,c=[],v=s.length;o<v;o++)(s[o].fn!==t||r&&!s[o].once||n&&s[o].context!==n)&&c.push(s[o]);c.length?this._events[i]=1===c.length?c[0]:c:clearEvent(this,i)}return this},HM_EventEmitter.prototype.removeAllListeners=function(e){var t;return e?(t=prefix?prefix+e:e,this._events[t]&&clearEvent(this,t)):(this._events=new HM_Events,this._eventsCount=0),this},HM_EventEmitter.prototype.off=HM_EventEmitter.prototype.removeListener,HM_EventEmitter.prototype.addListener=HM_EventEmitter.prototype.on,HM_EventEmitter.prototype.setMaxListeners=function(){return this},HM_EventEmitter.prefixed=prefix,HM_EventEmitter.HM_EventEmitter=HM_EventEmitter;
var CP_ERROR_MAP={read_int_val_insession:-1e3,set_selected_res_id:-1001,set_tested_bitrate:-1002,set_cur_res_id:-1003,get_bitrate_of_res_id:-1004,flash_check_failed:-1005,ajax_req_error:-1006,title_video_head_failed:-1007,title_not_video_type:-1008,play_title_video_timeout:-1009,play_title_video_failed:-1010,get_cid:-1011,get_cloudservice:-1012,get_did:-1013,get_config:-1014,stop_cloud_service:-1015,stop_all_cloud_service:-1016,multi_player:-1017,no_player_wrap:-1018,invalid_flash_bitrate:-1019,video_player_error:-1020,video_player_disconnect:-1021,input_socket_close_and_refresh_token:-1022,dont_get_cloud_service:-1023,show_player_info_failed:-1024,show_bottom_info_failed:-1025,show_notice_failed:-1026,show_upgrade_browser_info_failed:-1027,web_socket_init_failed:-1028,web_socket_check_init_failed:-1029,flash_check_end_after_player_close:-1030,set_json_map_failed:-1031,send_pay_msg_failed:-1032,require_portal_failed:-1033,get_local_key_map_failed:-1034,save_local_key_map_failed:-1035,set_flash_cookie:-1036,require_userid_error:-1037,invalid_adjx_action:-1038,set_res_list:-1039,invalid_res_list:-1040,get_name_of_res_id:-1041,set_min_bitrate:-1042,send_req_error_with_invalid_action:-1043,ajax_decrypt_error:-1044,saas_socket_check_error:-1045,input_socket_check_error:-1046,read_countly_info_in_storage_error:-1047,save_countly_info_to_storage_error:-1048,get_did_with_invalid_countly_info:-1049,init_sdk_fun_call_multi_error:-1050,start_sdk_fun_call_multi_error:-1051,show_tips_error:-1052,call_on_scene_changed_error:-1053,get_session_storage_error:-1054,show_background_img_error:-1055,record_countly_info_error:-1056,audio_load_error:-1057,eventEmitterIsNull:-1058,on_saas_message_error:-1059,on_pay_message_error:-1060,async_load_finished_multi_call:-1061,countly_module_inited_multi:-1062,js_player_inited_failed:-1063,js_player_not_inited_yet:-1064,js_player_object_not_found:-1065,input_socket_connect_multi_time:-1066,unknown_orientation:-1067,invalid_resolution_info:-1068,player_container_not_exist:-1069,game_options_param_invalid:-1070},__BASE_CODE=-8765,__hmLogWarn=function(_,e,r){try{var o=console.warn;_||(o=console.log,e+=__BASE_CODE),o(gCountlyInfo.transId+"  ["+e+"]"+(r?":  "+JSON.stringify(r):""))}catch(i){}},__hmLogError=function(_,e,r){try{var o=console.error;_||(o=console.info,e+=__BASE_CODE),o(gCountlyInfo.transId+"  ["+e+"]"+(r?":  "+JSON.stringify(r):""))}catch(i){}};
var CP_CONSTANT={};CP_CONSTANT.CLIENT_PC=1,CP_CONSTANT.CLIENT_ANDROID=2,CP_CONSTANT.CLIENT_WEB=3,CP_CONSTANT.CLIENT_IOS=4,CP_CONSTANT.CLIENT_MAC=5,CP_CONSTANT.CLIENT_H5_IOS=6,CP_CONSTANT.CLIENT_H5_ANDROID=7,CP_CONSTANT.CLIENT_TV=8,CP_CONSTANT.OS_IPHONE="iPhone",CP_CONSTANT.OS_IPAD="iPad",CP_CONSTANT.OS_ANDROID="Android",CP_CONSTANT.DEVICE_IPHONE5="iPhone5",CP_CONSTANT.DEVICE_IPHONE5s="iPhone5s",CP_CONSTANT.DEVICE_IPHONE6="iPhone6",CP_CONSTANT.DEVICE_IPHONE6s="iPhone6s",CP_CONSTANT.DEVICE_IPHONE7="iPhone7",CP_CONSTANT.ORIENTATION_PORTRAIT="portrait",CP_CONSTANT.ORIENTATION_LANDSCAPE="landscape",CP_CONSTANT.EVENT_TOUCH_START="cp.touch_start",CP_CONSTANT.EVENT_ORIENTATION_CHANGE="cp.orientation_change",CP_CONSTANT.EVENT_PLAYER_CONNECT="cp.player_connect",CP_CONSTANT.EVENT_PLAYER_READY="cp.player_ready",CP_CONSTANT.EVENT_PLAYER_CLOSED="cp.player_closed",CP_CONSTANT.EVENT_PLAYER_ERROR="cp.player_error",CP_CONSTANT.EVENT_PLAYER_AUDIO_START_PLAYING="cp.player_audio_start_playing",CP_CONSTANT.EVENT_STOP_SDK="cp.stop_sdk_internal",CP_CONSTANT.EVENT_REFRESH_PAGE_REQUIRE="cp.refresh_page_require",CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_NORMAL=0,CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_REFRESH_TOKEN=1,CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_CHANGE_RESOLUTION=2,CP_CONSTANT.UI_MESSAGE_TYPE_UNSUPPORT="unsupport",CP_CONSTANT.UI_MESSAGE_TYPE_PORTRAIT="portrait",CP_CONSTANT.UI_MESSAGE_TYPE_LANDSCAPE="landscape",CP_CONSTANT.UI_MESSAGE_TYPE_SYSTEM="system",CP_CONSTANT.UI_MESSAGE_TYPE_IOSWECHAT="iosWeChat",CP_CONSTANT.UI_MESSAGE_TYPE_ANDROIDWECHAT="androidWeChat",CP_CONSTANT.UI_MESSAGE_TYPE_REFRESH_REQUIRED="refreshRequired",CP_CONSTANT.UI_PLAYER_CONTAINER_ID="playGameBox",CP_CONSTANT.UI_PLAYER_DIV_ID="cpPlayerDivId",CP_CONSTANT.UI_PLAYER_DIV_CLASS="cpPlayerDivClass",CP_CONSTANT.API_ACTION_GET_DID="get_did",CP_CONSTANT.API_ACTION_GET_CONFIG="get_config",CP_CONSTANT.API_ACTION_GET_CID="get_cid",CP_CONSTANT.API_ACTION_GET_CLOUD_SERVICE="get_cloud_service",CP_CONSTANT.API_ACTION_STOP_CLOUD_SERVICE="stop_cloud_service",CP_CONSTANT.API_ACTION_ID_MAP={},CP_CONSTANT.API_ACTION_ID_MAP[CP_CONSTANT.API_ACTION_GET_DID]=104,CP_CONSTANT.API_ACTION_ID_MAP[CP_CONSTANT.API_ACTION_GET_CONFIG]=108,CP_CONSTANT.API_ACTION_ID_MAP[CP_CONSTANT.API_ACTION_GET_CID]=102,CP_CONSTANT.API_ACTION_ID_MAP[CP_CONSTANT.API_ACTION_GET_CLOUD_SERVICE]=201,CP_CONSTANT.API_ACTION_ID_MAP[CP_CONSTANT.API_ACTION_STOP_CLOUD_SERVICE]=202,CP_CONSTANT.CP_STOP_REASON={is_end:"time_limit",is_error:"instance_err",forced:"forced",kick_off:"no_operation",token_expire:"token_expire",logout:"log_off",disconnect:"network_off",request_error:"request_error",multi_inst:"multi_inst",low_bitrate:"low_bitrate",load_game_failed:"load_game_failed",queue_limit:"queue_limit",instance_limit:"instance_limit",verify_failed:"verify_failed",game_over:"game_over",internal_error:"internal_error",unqueue:"unqueue",unsupport_device:"unsupport_device",unsupport_privated_mode:"unsupport_privated_mode",need_refresh_page:"need_refresh_page",internal:"internal"},CP_CONSTANT.SAAS_OPERATION_CODE={interval_show_queue:1,kick_off:2,is_error:3,is_end:4,playing:5,whether_to_queue:6,queue_limit:7,crash_and_rescoring:8,asking:9,be_ready:10,stoken_refresh:11,change_resolution:12,resume_service:13,ready_pause_server:14,pause_server:15,paused_server:16,exceed_limit:21,forced_offline:22};
function __dummyFunction(){}var CP_UTILS={};CP_UTILS.IPHONE_WEIXIN_KERNEL="WeixinAppleWebKit",CP_UTILS.ANDROID_WEIXIN_KERNEL="WeixinAndroidWebKit",CP_UTILS.getBrowser=function(n){function e(n,e){return n}function t(n,e){o=n,_=e}var r,i=navigator.userAgent.toLowerCase(),o="",_=0;return(r=i.match(/msie ([\d.]+)/))?t("Trident",e(r[1])):(r=i.match(/firefox\/([\d.]+)/))?t("Gecko",e(r[1])):(r=i.match(/chrome\/([\d.]+)/))?t("WebKit",e(r[1])):(r=i.match(/opera.([\d.]+)/))?t("Presto",e(r[1])):(r=i.match(/version\/([\d.]+).*safari/))?t("WebKit",e(r[1])):(r=i.match(/micromessenger\/([\d.]+)/))?t(CP_UTILS.detectOS()==CP_CONSTANT.OS_IPHONE?CP_UTILS.IPHONE_WEIXIN_KERNEL:CP_UTILS.ANDROID_WEIXIN_KERNEL,e(r[1])):0,"kernel"==n?o:"version"==n?_:""},CP_UTILS.detectOS=function(){var n=navigator.userAgent;if(/iPhone/i.test(n))return CP_CONSTANT.OS_IPHONE;if(/iPad/i.test(n))return CP_CONSTANT.OS_IPAD;if(/Android/i.test(navigator.userAgent))return CP_CONSTANT.OS_ANDROID;var e="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;if(e)return"Mac";var t="X11"==navigator.platform&&!i&&!e;if(t)return"Unix";var r=String(navigator.platform).indexOf("Linux")>-1;if(r)return"Linux";var i="Win32"==navigator.platform||"Windows"==navigator.platform;if(i){var o=n.indexOf("Windows NT 5.0")>-1||n.indexOf("Windows 2000")>-1;if(o)return"Win2000";var _=n.indexOf("Windows NT 5.1")>-1||n.indexOf("Windows XP")>-1;if(_)return"WinXP";var T=n.indexOf("Windows NT 5.2")>-1||n.indexOf("Windows 2003")>-1;if(T)return"Win2003";var a=n.indexOf("Windows NT 6.0")>-1||n.indexOf("Windows Vista")>-1;if(a)return"WinVista";var O=n.indexOf("Windows NT 6.1")>-1||n.indexOf("Windows 7")>-1;if(O)return"Win7";var C=n.indexOf("Windows NT 6.2")>-1||n.indexOf("Windows 8")>-1;if(C)return"Win8";var N=n.indexOf("Windows NT 10.0")>-1||n.indexOf("Windows NT 6.4")||n.indexOf("Windows 10")>-1;if(N)return"Win10"}return"other"},CP_UTILS.isMobile=function(){for(var n=[CP_CONSTANT.OS_IPHONE,CP_CONSTANT.OS_IPAD,CP_CONSTANT.OS_ANDROID],e=CP_UTILS.detectOS(),t=0;t<n.length;t++)if(e==n[t])return!0;return!1},CP_UTILS.isInWeixin=function(){return CP_UTILS.isIniOSWeixin()||CP_UTILS.isInAndroidWeixin()},CP_UTILS.isIniOSWeixin=function(){return CP_UTILS.getBrowser("kernel")==CP_UTILS.IPHONE_WEIXIN_KERNEL},CP_UTILS.isInAndroidWeixin=function(){return CP_UTILS.getBrowser("kernel")==CP_UTILS.ANDROID_WEIXIN_KERNEL},CP_UTILS.getBasePath=function(n){var e="",t=document.getElementsByTagName("script");if(t&&t.length>0)for(var r in t)try{var i=t[r].src,o=i.indexOf(n);if(o>0){e=i.slice(0,o);break}}catch(_){}return e},CP_UTILS.hasOwnProperty=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},CP_UTILS.setSessionStore=function(n,e){CP_UTILS.hasOwnProperty(sessionStorage,"CLOUDPLAY")||sessionStorage.setItem("CLOUDPLAY","");var t={};return sessionStorage.CLOUDPLAY&&(t=JSON.parse(sessionStorage.CLOUDPLAY)),t[n]=e,sessionStorage.CLOUDPLAY=JSON.stringify(t),!0},CP_UTILS.getSessionStore=function(n){if(!CP_UTILS.hasOwnProperty(sessionStorage,"CLOUDPLAY")||!sessionStorage.CLOUDPLAY)return{};try{var e=JSON.parse(sessionStorage.CLOUDPLAY);return n?e[n]:e}catch(t){return __hmLogError(null,CP_ERROR_MAP.get_session_storage_error,t.toString()),{}}},CP_UTILS.isWebsocketObject=function(n){try{return n&&(n instanceof WebSocket||n instanceof window.NativeWebSocket)}catch(e){return n}},CP_UTILS.websocket_send=function(n,e,t){n&&n.readyState==WebSocket.OPEN&&n.send(e,t)},CP_UTILS.websocket_close=function(n,e){n&&(n.onopen=__dummyFunction,n.onmessage=__dummyFunction,n.onclose=__dummyFunction,e&&n.close())},CP_UTILS.mixTips=function(n,e){for(var t=0;t<e.length;t++)n=n.replace("|",e[t]);return n.replace(/\n/g,"<br />")},CP_UTILS.orientation=function(){if(!CP_UTILS.isMobile())return CP_CONSTANT.ORIENTATION_PORTRAIT;switch(window.orientation){case 0:return CP_CONSTANT.ORIENTATION_PORTRAIT;case 180:return CP_CONSTANT.ORIENTATION_PORTRAIT;case-90:return CP_CONSTANT.ORIENTATION_LANDSCAPE;case 90:return CP_CONSTANT.ORIENTATION_LANDSCAPE;default:__hmLogWarn(null,CP_ERROR_MAP.unknown_orientation,window.orientation)}return"unknown"},CP_UTILS.deviceType=function(){if(CP_UTILS.detectOS()==CP_CONSTANT.OS_IPHONE)try{var n,e=document.createElement("canvas"),t=e.getContext("experimental-webgl"),r=t.getExtension("WEBGL_debug_renderer_info");if(null!=r&&(n=t.getParameter(r.UNMASKED_RENDERER_WEBGL))){if(n=n.toString().toUpperCase(),n.indexOf("A6")>-1)return CP_CONSTANT.DEVICE_IPHONE5;if(n.indexOf("A7")>-1)return CP_CONSTANT.DEVICE_IPHONE5s;if(n.indexOf("A8")>-1)return CP_CONSTANT.DEVICE_IPHONE6;if(n.indexOf("A9")>-1)return CP_CONSTANT.DEVICE_IPHONE6s;if(n.indexOf("A10")>-1)return CP_CONSTANT.DEVICE_IPHONE7}}catch(i){}return"unknown"},CP_UTILS.isSupportDevice=function(){if(CP_UTILS.isMobile()){for(var n=CP_UTILS.deviceType(),e=[CP_CONSTANT.DEVICE_IPHONE5,CP_CONSTANT.DEVICE_IPHONE5s,CP_CONSTANT.DEVICE_IPHONE6,CP_CONSTANT.DEVICE_IPHONE6s,CP_CONSTANT.DEVICE_IPHONE7],t=0;t<e.length;t++)if(n==e[t])return!0;return!1}return!0},CP_UTILS.clientType=function(){return CP_UTILS.detectOS()==CP_CONSTANT.OS_IPHONE||CP_UTILS.detectOS()==CP_CONSTANT.OS_IPAD?CP_CONSTANT.CLIENT_H5_IOS:CP_UTILS.detectOS()==CP_CONSTANT.OS_ANDROID?CP_CONSTANT.CLIENT_H5_ANDROID:CP_CONSTANT.CLIENT_H5_IOS},CP_UTILS.getUrlQueryString=function(n){try{var e=window.location.search.match(new RegExp("[?&]"+n+"=([^&]+)","i"));return null==e||e.length<1?"":e[1]}catch(t){return""}},CP_UTILS.onNetworkStatus=function(n){var e=function(e){n(e)},t=function(){e(!0)},r=function(){e(!1)};window.addEventListener?(window.addEventListener("online",t,!1),window.addEventListener("offline",r,!1)):(document.body.ononline=t,document.body.onoffline=r)};
var countly_event_id_map={start_sdk:10012,input_socket_connecting:12085,input_socket_connect_opend:10021,input_socket_connect_closed:10022,input_socket_connect_failed:12049,input_socket_check_failed:12097,input_socket_start_im:12094,input_socket_stop_im:12095,input_socket_ping_pong_delay_time:10050,input_socket_ping_pong_delay_max:10033,close_by_error:10024,normal_close:10025,frame_miss:10026,out_queue:10039,fullscreen:12001,exit_fullscreen:12002,toolbar_keyboard_btn_clicked:12006,toolbar_lag_btn_clicked:12092,toolbar_unlag_btn_clicked:12093,keyboard_setting_reset:12008,keyboard_setting_save:12009,keyboard_setting_clear_all:12051,keyboard_setting_set_game_pad:12052,auto_resolution_changed_start:12011,auto_resolution_changed_done:12012,auto_resolution_changed_fail:12013,manual_resolution_changed_start:12014,manual_resolution_changed_done:12015,manual_resolution_changed_fail:12016,user_continue:12019,loading_pic_success:12020,loading_pic_fail:12021,pre_load_backgound_done:12022,pre_load_backgound_fail:12023,title_video_loading:12024,title_video_load_done:12025,title_video_load_fail:12026,title_video_play:12027,title_video_play_done:12028,title_video_play_fail:12029,speed_test_start:12030,speed_test_done:12031,speed_test_fail:12032,audio_stream_connecting:12086,audio_stream_connected:12033,audio_stream_connect_fail:12035,audio_stream_connect_disconnected:12047,video_stream_connecting:12087,video_stream_connected:12034,video_stream_connect_fail:12036,video_stream_connect_disconnected:12048,frame_delay_timeout:12038,start_revolution:12039,frame_delay_info:12042,video_url_got:12044,video_first_frame_arrived:12045,video_visible_frame_ready:12105,low_bitrate_detected:12046,init_sdk_fun_call:12058,init_sdk_fun_call_multi_error:12106,start_sdk_fun_call:12059,start_sdk_fun_call_multi_error:12107,start_sdk_fun_call_by_sdk:12109,stop_sdk_fun_Call:12053,check_flash_version_succeed:12056,check_flash_version_failed:12057,get_did_start:12063,get_did_succeed:12078,get_did_failed:12079,get_config_start:12084,get_config_succeed:12080,get_config_failed:12081,get_cid_start:12082,get_cid_succeed:12072,get_cid_failed:12073,get_clound_service_start:12083,get_clound_service_succeed:12074,get_clound_service_failed:12075,stop_clound_service_start:12091,stop_clound_service_succeed:12076,stop_clound_service_failed:12077,saas_socket_connecting:12088,saas_socket_opened:12089,saas_socket_closed:12090,saas_socket_failed:12050,saas_socket_message:12054,saas_socket_check_failed:12096,saas_socket_already_opened:12102,saas_socket_close_pre:12103,dont_get_cloud_service:12098,show_loading_view:12099,hide_loading_view:12100,show_info_page:12101,reconnecting:12104,init_websocket_module_result:12108,set_stop_mouse_send_flag:12110,page_closed:12111,countly_invalid_data_from_get_did:12112,countly_url_modified:12113,async_load_finished:12114,start_async_load:12115,device_un_support:12300,click_download:12301},countly_event_custom_error={decrypt_failed:-1e4,video_disconnect:-10001,saas_message_parser_error:-10002,video_stream_unknown_error:-10003,video_stream_load_failed:-10004,flash_load_failed:-10005,socket_close_by_self:-10006},scene_event_ids={12058:!0,12106:!0,12059:!0,12107:!0,12063:!0,12078:!0,12079:!0,12084:!0,12080:!0,12081:!0,12056:!0,12057:!0,12082:!0,12072:!0,12088:!0,12089:!0,12044:!0,10012:!0,12112:!0,12113:!0,12114:!0,12115:!0,12300:!0};window.CP_IS_COUNTLY_INITED=!1;var CP_CountlyInit=function(e){function t(){if(CP_UTILS.hasOwnProperty(sessionStorage,f))try{sessionStorage[f]&&(y=JSON.parse(sessionStorage[f]))}catch(e){__hmLogError(null,CP_ERROR_MAP.read_countly_info_in_storage_error,e.toString())}}function _(){try{sessionStorage[f]=JSON.stringify(y)}catch(e){__hmLogError(null,CP_ERROR_MAP.save_countly_info_to_storage_error,e.toString())}}function n(e){var t,_,n="",o="0123456789abcdef";for(t=0;t<8;t++)n+=o.charAt(Math.round(15*Math.random()));for(t=0;t<3;t++)for(n+="-",_=0;_<4;_++)n+=o.charAt(Math.round(15*Math.random()));n+="-";var a=(new Date).getTime();for(n+=("0000000"+a.toString(16).toUpperCase()).substr(-8),t=0;t<4;t++)n+=o.charAt(Math.round(15*Math.random()));return n+"-"+e+CP_UTILS.detectOS()+CP_UTILS.getBrowser("name")}function o(){t(),y.transId==-1&&a(CryptoJS.MD5(n((new Date).getTime()))),y.isConnected=!1}function a(e){y.transId=e.toString(),_()}function i(){y.playId=y.playId+1,_()}function s(e){y.serverTimestamp=e,_()}function d(e){y.isConnected=e}function c(e,t){Countly.q=Countly.q||[],Countly.app_key=t,Countly.url=e,Countly.force_post=!0,Countly.fail_timeout=2,g&&(Countly.max_events=1),Countly.init()}function r(e){k||(Countly.forceSendCountlyEvent(),k=!0,setTimeout(function(){k=!1},3e3))}function l(e,t,_,n,o){C.sendCount+=1,scene_event_ids[n]&&u.emit("cp.sceneChanged","evnt",{eventId:n});var a=CP_UTILS.getSessionStore("cloud_cidinfo"),i=CP_UTILS.getSessionStore("game_options")||{},s="";a&&CP_UTILS.hasOwnProperty(a,"cid")&&CP_UTILS.hasOwnProperty(i,"userinfo")&&(s=a.cid);var d=Date.now();d<=I&&(d=I+1),I=d,o||0==o||(o="");var c={key:"HMCPWebEvent",segmentation:{key:S,timeStamp:d+"",deviceID:e,eventID:n,cloudID:s,channel:t,extraId:i.extraId,eventData:o,uid:i.userinfo?i.userinfo.uId:"",accessKeyId:_,networkType:"WIFI",netStatus:"WIFI",clientTransId:[y.transId,y.playId].join("."),serverTimestamp:y.serverTimestamp}};Countly.q=Countly.q||[],Countly.q.push(["add_event",c])}if(CP_IS_COUNTLY_INITED)return void __hmLogError(null,CP_ERROR_MAP.countly_module_inited_multi);window.CP_IS_COUNTLY_INITED=!0;var u=e,f="cloudplay_key_countlyInfo",y={transId:-1,playId:0,serverTimestamp:-1,isConnected:!1},g=!1,p=1e4,m=0,C={url:"",sendCount:0,countlyModuleSendCount:0,countlyModuleSucceedCount:0,countlyModuleSendFailedCount:0},v=function(){try{if(!y.isConnected)return;var e=Countly.getStatisticsInfo();C.url!=e.url&&(l(countly_event_id_map.countly_url_modified),C.url=e.url),m==C.sendCount&&C.countlyModuleSendCount==e.sendCount&&C.countlyModuleSucceedCount==e.sendSucceedCount&&C.countlyModuleSendFailedCount==e.sendFailedCount||(m=C.sendCount,C.countlyModuleSendCount=e.sendCount,C.countlyModuleSucceedCount=e.sendSucceedCount,C.countlyModuleSendFailedCount=e.sendFailedCount,C.url=e.url,u.emit("cp.sceneChanged","clst",{info:JSON.stringify(C)}))}catch(t){__hmLogError(null,CP_ERROR_MAP.record_countly_info_error,t.toString())}};o();var k=!1,I=0,S=CP_UTILS.clientType();return o(),{setServerInfo:function(e,t,_){y.isConnected||(s(_),d(!0),c(e,t),g&&(C.url=e,v()))},startRecordStatisticInfo:function(){g||(g=!0,setInterval(v,p))},sessionId:function(){return[y.transId,y.playId].join(".")},incPlayId:i,sendCountly:l,forceSendCountlyEventWhenClosed:r}};
var _cpIE8CorsAjax=function(t){try{var e=new XDomainRequest;/^\d+$/.test(t.timeout)&&(e.timeout=t.timeout),e.ontimeout=function(){t.done(!1,"timeout")},e.onload=function(){t.done(!0,e.responseText)},e.onprogress=function(){},e.onerror=function(){t.done(!1,"onerror: "+e.responseText)},t.data&&(postData=t.data),e.open(t.method,t.url),e.send(t.data)}catch(n){t.done(!1,"Exception: "+n.toString())}},__cp_ajax=function(t){try{var e=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null;"GET"===t.method?e.open("GET",t.url,!0):(e.open("POST",t.url,!0),e.setRequestHeader("Content-type",t.contentType)),e.onreadystatechange=function(){4===this.readyState&&this.status>=200&&this.status<300?t.done(!0,e.responseText):4===this.readyState&&t.done(!1,"invalid status: "+this.status)},"GET"==t.method?e.send():e.send(t.data)}catch(n){t.done(!1,"Exception: "+n.toString())}},cloudplay_ajax=function(t){var e=1;if(t&&CP_UTILS.hasOwnProperty(t,"tryCount")&&(e=parseInt(t.tryCount)),e<=1)return void __cp_ajax(t);var n=500;t&&CP_UTILS.hasOwnProperty(t,"retryInterval")&&(n=parseInt(t.retryInterval));var o=t.done,a=function(a,r){return a?(t.done=o,void o(!0,r)):(e-=1,0==e?(t.done=o,void o(!1,r)):void setTimeout(function(){__cp_ajax(t)},n))};t.done=a,__cp_ajax(t)};
function CP_isPortraitGame(){var e=CP_UTILS.getSessionStore("game_options");return e&&e.isPortrait}function CP_getClass(e,t){if(document.getElementsByClassName)return document.getElementsByClassName(t);var n=document.getElementsByTagName(e),d=[];return n[i]["class"]==t&&(d[d.length]=n[i]),d}function CP_showLoadingView(e){for(var e=e,t=CP_getClass("div","backgroundCover"),n=document.getElementById("playGameBox"),d=t.length-1;d>=0;d--)try{n.removeChild(t[d])}catch(i){}Cloudplay.sendCountly(countly_event_id_map.show_loading_view);var a=document.getElementById("loadingBox");if(null==a){var l=document.createElement("div");l.setAttribute("class","c1");var o=document.createElement("div");o.setAttribute("class","c2");var r=document.createElement("div");r.setAttribute("class","c3");var c=document.createElement("div");c.setAttribute("class","c4");var m=document.createElement("span"),s=document.createTextNode("loading");m.appendChild(s);var u=document.createElement("div");u.appendChild(l),u.appendChild(o),u.appendChild(r),u.appendChild(c);var g=document.createElement("div");g.setAttribute("class","loading"),g.setAttribute("id","loadingBox"),g.appendChild(u),g.appendChild(m),n.appendChild(g);var v=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,p=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,h=(p-v)/2;if("startSDK"!=e){var C=CP_isPortraitGame();if("false"==C||0==C){var a=document.getElementById("loadingBox");a.setAttribute("class","loading rotate90"),a.setAttribute("style","width:"+p+"px; height:"+v+"px;left:-"+h+"px;top:"+h+"px;")}}}}function CP_hideLoadingView(){Cloudplay.sendCountly(countly_event_id_map.hide_loading_view);var e=document.getElementById("loadingBox");if(null!=e){var t=document.getElementById("playGameBox");t.removeChild(e)}}
var _CP_loadScript=function(e,t,a,n){var o=document.createElement("script");o.src=e;var r=document.getElementsByTagName("head")[0],d=!1;o.onload=o.onreadystatechange=function(){d||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(d=!0,n(e,t,!0),o.onload=o.onreadystatechange=null,a&&r.removeChild(o))},r.appendChild(o)},CP_AsyncLoadJsFiles=function(e,t,a,n){if(t){var o=function(t,r,d){return d?(r+=1,r<e.length?void _CP_loadScript(e[r],r,a,o):void n(!0)):void n(!1)};return void _CP_loadScript(e[0],0,a,o)}for(var r=[],d=0;d<e.length;d++)r.push(!1),_CP_loadScript(e[d],d,a,function(t,a,o){if(!o)return void n(!1);r[a]=!0;for(var d=!0,i=0;i<e.length;i++)if(!r[i]){d=!1;break}d&&n(!0)})},CP_AsyncLoadCssFiles=function(e,t,a){};
var Cloudplay=function(e,_){function n(){return Se||(Se=localStorage.cloud_did),Se}function t(e){localStorage.cloud_did=e,Se=e}function o(e){var _="abcdefghijklmnopqrstuvwxyz0123456789";e=e||16;for(var n="",t=0;t<e;t++)n+=_.charAt(Math.floor(Math.random()*_.length));return n}function i(e,n){var t=_.enc.Utf8.parse(n),o=_.AES.encrypt(e,t,{mode:_.mode.ECB,padding:_.pad.Pkcs7});return o.toString()}function r(e,n){var t=_.enc.Utf8.parse(n),o=_.AES.decrypt(e,t,{mode:_.mode.ECB,padding:_.pad.Pkcs7});return _.enc.Utf8.stringify(o)}function a(e,_){var n={};return n[CP_CONSTANT.API_ACTION_GET_DID]=countly_event_id_map.get_did_failed,n[CP_CONSTANT.API_ACTION_GET_CONFIG]=countly_event_id_map.get_config_failed,n[CP_CONSTANT.API_ACTION_GET_CID]=countly_event_id_map.get_cid_failed,n[CP_CONSTANT.API_ACTION_GET_CLOUD_SERVICE]=countly_event_id_map.get_clound_service_failed,n[CP_CONSTANT.API_ACTION_STOP_CLOUD_SERVICE]=countly_event_id_map.stop_clound_service_failed,CP_UTILS.hasOwnProperty(n,e)?void Oe(n[e],_?_:-1):void __hmLogError(null,CP_ERROR_MAP.send_req_error_with_invalid_action,[e,_])}function s(e,_,t,s){if(!(_ in CP_CONSTANT.API_ACTION_ID_MAP))return __hmLogWarn(null,CP_ERROR_MAP.invalid_adjx_action,[e,_]),!1;var c=navigator||{},d={hardDecoderSupported:"1",osName:CP_UTILS.detectOS(),osVersion:CP_UTILS.detectOS(),webInfo:{installLocSignYN:"",cookieId:"",userAgent:c.userAgent,browserType:c.vendor,platform:c.platform,browserVersion:CP_UTILS.getBrowser("version"),browserKernel:CP_UTILS.getBrowser("kernel"),browserKernelVersion:navigator.appVersion.substring(navigator.appVersion.lastIndexOf("/")+1,navigator.appVersion.length),flashPlayerVersion:-1},screenInfo:{dpi:"",resolution:window.screen.width+"*"+window.screen.height}},l={accessKeyID:le,packageName:"haima",sdkVersion:SDK_VERSION,channel:de},u="",C="";if(_===CP_CONSTANT.API_ACTION_GET_DID||_===CP_CONSTANT.API_ACTION_GET_CID||_===CP_CONSTANT.API_ACTION_GET_CONFIG)C=o(),u=Q+C;else{var T=CP_UTILS.getSessionStore("cloud_cidinfo")||{};u=T.secret_key,C=T.cid}var t={action:{actId:CP_CONSTANT.API_ACTION_ID_MAP[_],transId:(new Date).getTime()+o(4)||1,protocol:z,random:C,sdkType:Y,did:n()||"",clientTransId:D.sessionId()},data:i(JSON.stringify(t),u),device:i(JSON.stringify(d),u),client:i(JSON.stringify(l),u)},S={url:e,data:JSON.stringify(t),method:"POST",contentType:"text/plain",tryCount:_==CP_CONSTANT.API_ACTION_GET_DID||_==CP_CONSTANT.API_ACTION_GET_CONFIG?3:1,done:function(n,t){if(n){var o=JSON.parse(t);if(0===o.code)try{o.data=JSON.parse(r(o.data,u))}catch(i){__hmLogError(null,CP_ERROR_MAP.ajax_decrypt_error,[_,i.toString()]),o.code=countly_event_custom_error.decrypt_failed}return void s(o)}Ee=!1,__hmLogWarn(null,CP_ERROR_MAP.ajax_req_error,[e,_,t]),a(_,t),_!==CP_CONSTANT.API_ACTION_STOP_CLOUD_SERVICE&&v(F.prompt_network_unavailable?F.prompt_network_unavailable:Te,V,!1,CP_CONSTANT.CP_STOP_REASON.request_error)}};cloudplay_ajax(S)}function c(e,_,n){if(!e||!_)return{};var t={};for(var o in e){var i=e[o];if(i&&i.hasOwnProperty(_)){var o=i[_];n?t[o]=i[n]||"":t[o]=i}}return t}function d(e,_,t,o,i){if(Oe(countly_event_id_map.get_cid_start),ue=CP_UTILS.getSessionStore("cloud_cidinfo"),ue&&CP_UTILS.hasOwnProperty(ue,"cid")&&ue.cid)return ee=!0,W==CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_NORMAL&&(W=CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_REFRESH_TOKEN),Oe(countly_event_id_map.get_cid_succeed,1),w.emit("cp.get_cid_done",ue),i(ue.cid);if(!n())return void u(t);var r=CP_UTILS.getSessionStore("game_options"),c=SAAS_AUTH,d={did:n(),type:Y,userInfo:e,configInfo:_,pkgName:t,extraId:r.extraId,envType:envType,CToken:o};s(c,CP_CONSTANT.API_ACTION_GET_CID,d,function(e){if(_e=!1,0===e.code){Oe(countly_event_id_map.get_cid_succeed,0);var _=e.data,n={cid:_.cidId,saas_ws:_.msgServInfo&&_.msgServInfo.socketUrl,secret_key:_.secretKey,sign:_.sign,resolutionInfo:_.resolutionInfo,minimumBitRate:_.minimumBitRate};return w.emit("cp.get_cid_done",n),i(e.data.cid)}__hmLogError(null,CP_ERROR_MAP.get_cid,e.code),a(CP_CONSTANT.API_ACTION_GET_CID,e.code),10201===e.code?(localStorage.removeItem("cloud_did"),_e=!0,u(t)):10202===e.code?v("已超过多开上限，请关闭此页面",V,!1,CP_CONSTANT.CP_STOP_REASON.instance_limit):v("账号验证失败",V,!1,CP_CONSTANT.CP_STOP_REASON.verify_failed)})}function l(e,_){if(e){Oe(countly_event_id_map.get_clound_service_start);var n=CP_UTILS.getSessionStore("game_options")||{},t=SAAS_AUTH,o={resId:123,cid:e.cid,sign:e.sign,priority:n.priority||0,confirm:_||0,clientType:Y,orientation:1,playingtime:n.playingtime,opType:W,envType:envType,payStr:n.payStr||"",deviceType:CP_UTILS.deviceType()};if(U&&U.isUserSelectedResMode())o.resolution=U.curResId();else{var i=-1;o.bitRate=i}s(t,CP_CONSTANT.API_ACTION_GET_CLOUD_SERVICE,o,function(e){0===e.code?(Oe(countly_event_id_map.get_clound_service_succeed),w.emit("cp.cloud_service_ready",e.data.resultId)):(a(CP_CONSTANT.API_ACTION_GET_CLOUD_SERVICE,e.code),setTimeout(function(){v(e.msg,V,!1,CP_CONSTANT.CP_STOP_REASON.internal_error)},3e3),__hmLogError(null,CP_ERROR_MAP.get_cloudservice,e.code))})}}function u(e){var _=n()||0,o=SAAS_AUTH,i={did:_,envType:envType,type:Y};Oe(countly_event_id_map.get_did_start),s(o,CP_CONSTANT.API_ACTION_GET_DID,i,function(_){0===_.code&&_.data?(_.data.countlyUrl&&_.data.countlyAppKey&&_.data.serverTimestamp?D.setServerInfo(_.data.countlyUrl,_.data.countlyAppKey,_.data.serverTimestamp):(Oe(countly_event_id_map.countly_invalid_data_from_get_did),__hmLogError(null,CP_ERROR_MAP.get_did_with_invalid_countly_info,[_.data.countlyUrl,_.data.countlyAppKey,_.data.serverTimestamp])),Oe(countly_event_id_map.get_did_succeed),t(_.data.did),w.emit("cp.reg_sdk_done",_.data.did,e)):(__hmLogError(null,CP_ERROR_MAP.get_did,_.code),a(CP_CONSTANT.API_ACTION_GET_DID,_.code),v(_.msg?_.msg:Te,V,!1,CP_CONSTANT.CP_STOP_REASON.internal_error))})}function C(e,_){var n={accessKeyId:le,packageName:e,type:_||0,envType:envType};Oe(countly_event_id_map.get_config_start),s(SAAS_AUTH,CP_CONSTANT.API_ACTION_GET_CONFIG,n,function(_){if(0===_.code&&_.data){Oe(countly_event_id_map.get_config_succeed);var n=_.data;if(B=c(n.setDataInfo,"k","v"),se=n,F=c(n.interactiveTalkInfo,"k","v"),q=n.tipsInfo,U&&(U.setAuthData(n,F,q,B),!CP_UTILS.isSupportDevice()))return void U.showMessageView(CP_CONSTANT.UI_MESSAGE_TYPE_UNSUPPORT);w.emit("cp.get_auth_config_done",e)}else __hmLogError(null,CP_ERROR_MAP.get_config,_.code),a(CP_CONSTANT.API_ACTION_GET_CONFIG,_.code),v(_.msg?_.msg:Te,V,!1,CP_CONSTANT.CP_STOP_REASON.internal_error)})}function T(){if(!CP_UTILS.hasOwnProperty(sessionStorage,"CLOUDPLAY"))return!1;var e=JSON.parse(sessionStorage.CLOUDPLAY);return!!CP_UTILS.hasOwnProperty(e,"cloud_cidinfo")&&e.cloud_cidinfo}function S(e){return e&&(le=e.accessKeyID,de=e.channelId),pe||T()||D.incPlayId(),pe?(Oe(countly_event_id_map.init_sdk_fun_call_multi_error),void __hmLogError(null,CP_ERROR_MAP.init_sdk_fun_call_multi_error)):(e&&CP_UTILS.hasOwnProperty(e,"recordCountlyStatisticsInfo")&&e.recordCountlyStatisticsInfo&&D.startRecordStatisticInfo(),e.onSceneChanged&&w.on("cp.sceneChanged",function(_,n){try{e.onSceneChanged(_,n)}catch(t){__hmLogError(null,CP_ERROR_MAP.call_on_scene_changed_error,t.toString())}}),Oe(countly_event_id_map.init_sdk_fun_call),pe=!0,CP_UTILS.hasOwnProperty(e,"accessKeyID")?CP_UTILS.hasOwnProperty(e,"channelId")?CP_UTILS.hasOwnProperty(e,"MessageHandler")?(e.MessageHandler&&(ce=e.MessageHandler),w.emit("cp.sceneChanged","init"),u(e.pkg_name)):void m("初始化错误:messageHandler 未定义"):void m("初始化错误:channelId 未定义"):void m("初始化错误:accessKeyID 未定义"))}function P(e,_){var t=CP_UTILS.getSessionStore("game_options")||{};ue=CP_UTILS.getSessionStore("cloud_cidinfo")||{};var o=t.userinfo||{},i=e+"/websocket?did="+n()+"&cid="+ue.cid+"&uid="+o.uId+"&appId="+le+"&sign="+ue.sign;O(i)}function O(_,n){if(!K&&b){if(Oe(countly_event_id_map.saas_socket_connecting),n>X)return Oe(countly_event_id_map.saas_socket_failed),void v(F.prompt_crash,V,!1,CP_CONSTANT.CP_STOP_REASON.internal_error);Ce=new e(_);var t=Ce;Ce.onopen=function(){if(Ce!=t)return Oe(countly_event_id_map.saas_socket_check_failed,"onopen"),void __hmLogError(null,CP_ERROR_MAP.saas_socket_check_error,"onopen");if(Oe(countly_event_id_map.saas_socket_opened),n>0&&(n=0),null==Ae&&(Ae=setInterval(function(){CP_UTILS.websocket_send(Ce,"")},1e4)),te){var e=U&&U.isPlayerRunning();return __hmLogWarn(null,CP_ERROR_MAP.dont_get_cloud_service,e),void Oe(countly_event_id_map.dont_get_cloud_service,e)}var _=CP_UTILS.getSessionStore("cloud_cidinfo");l(_)},n=n||0,Ce.onclose=function(e){if(Ce!=t)return Oe(countly_event_id_map.saas_socket_check_failed,"onclose"),void __hmLogError(null,CP_ERROR_MAP.saas_socket_check_error,"onclose");var o=e&&e.code?e.code:-1;Oe(countly_event_id_map.saas_socket_closed,o),K||(clearInterval(Ae),Ae=null,ve=setTimeout(function(){O(_,n+1)},1e3+2e3*n))},Ce.onmessage=function(e){if(Ce!=t)return void Oe(countly_event_id_map.saas_socket_check_failed,"onmessage");var _=null;try{_=JSON.parse(e.data);var n=[],o=null;if(n.push(_.type),2===_.type?(o=JSON.parse(_.payload),n.push(o.operation)):n.push(encodeURIComponent(_.payload)),n.push(_.ack),n.push(_.mid),n.push(_.to),Oe(countly_event_id_map.saas_socket_message,n.join(",")),0===_.ack){if(1===_.type&&ce){try{ce(_)}catch(i){__hmLogError(null,CP_ERROR_MAP.on_pay_message_error,i.toString())}return}if(2===_.type)switch(o.operation){case CP_CONSTANT.SAAS_OPERATION_CODE.exceed_limit:v(F.toast_open_same_game,V,!1,CP_CONSTANT.CP_STOP_REASON.multi_inst);break;case CP_CONSTANT.SAAS_OPERATION_CODE.forced_offline:v(F.tips_forced_offline_action,V,!1,CP_CONSTANT.CP_STOP_REASON.token_expire);break;case CP_CONSTANT.SAAS_OPERATION_CODE.playing:oe=!0;var r=o.data;Ee=!1,Oe(countly_event_id_map.video_url_got,r.videoUrl),w.emit("cp.get_rtmp_addr",r);break;case CP_CONSTANT.SAAS_OPERATION_CODE.interval_show_queue:if(Ne&&o.data.index>=Ne)return;Ne=o.data.index;var a=CP_UTILS.mixTips(F.prompt_wait_man_time,[o.data.index]);a=a.replace("|",[o.data.timeStr]),a=o.data.timeStr?a.replace("|",[o.data.timeStr]):CP_UTILS.mixTips(F.prompt_wait_message,[o.data.index]),m(a,!0),w.emit("cp.sceneChanged","wait");break;case CP_CONSTANT.SAAS_OPERATION_CODE.asking:m(F.toast_instance_apply,!0);break;case CP_CONSTANT.SAAS_OPERATION_CODE.be_ready:break;case CP_CONSTANT.SAAS_OPERATION_CODE.whether_to_queue:var a=CP_UTILS.mixTips(F.toast_wait_choose,[o.data.index]);E(a);break;case CP_CONSTANT.SAAS_OPERATION_CODE.is_error:var a=F.prompt_hmcp_error;v(a,G,!1,CP_CONSTANT.CP_STOP_REASON.is_error);break;case CP_CONSTANT.SAAS_OPERATION_CODE.crash_and_rescoring:var a=F.prompt_crash;m(a),w.emit("cp.reconnect",-1);break;case CP_CONSTANT.SAAS_OPERATION_CODE.is_end:var a=F.prompt_game_over;v(a,V,!1,CP_CONSTANT.CP_STOP_REASON.is_end);break;case CP_CONSTANT.SAAS_OPERATION_CODE.kick_off:var a=F.toast_no_input;v(a,G,!1,CP_CONSTANT.CP_STOP_REASON.kick_off);break;case CP_CONSTANT.SAAS_OPERATION_CODE.queue_limit:var a=F.toast_wait_tooMany;v(a,G,!1,CP_CONSTANT.CP_STOP_REASON.queue_limit);break;case CP_CONSTANT.SAAS_OPERATION_CODE.stoken_refresh:break;case CP_CONSTANT.SAAS_OPERATION_CODE.resume_service:var a=F.tips_saas_service_resume;v(a,G,!1),w.emit("cp.sceneChanged","mait",{progress:"done"});break;case CP_CONSTANT.SAAS_OPERATION_CODE.ready_pause_server:var a=CP_UTILS.mixTips(F.tips_saas_ready_to_stop,[o.data.timeStr]);I(a),w.emit("cp.sceneChanged","mait",{progress:"soon"});break;case CP_CONSTANT.SAAS_OPERATION_CODE.pause_server:if(U&&U.isPlayerRunning())break;var a=F.tips_saas_to_stop;v(a,V,!1),w.emit("cp.sceneChanged","mait",{progress:"soon"});break;case CP_CONSTANT.SAAS_OPERATION_CODE.paused_server:var a=CP_UTILS.mixTips(F.tips_saas_already_stopped,[o.data.endTimeText]);v(a,V,!1),w.emit("cp.sceneChanged","mait",{progress:"start"})}}}catch(i){__hmLogError(null,CP_ERROR_MAP.on_saas_message_error,i.toString()),Oe(countly_event_id_map.saas_socket_message,["InvalidType",countly_event_custom_error.saas_message_parser_error].join(","))}}}}function p(e,_){if(e.isPortrait!==!0&&e.isPortrait!==!1)return void __hmLogError(null,CP_ERROR_MAP.game_options_param_invalid);if(Oe(_?countly_event_id_map.start_sdk_fun_call_by_sdk:countly_event_id_map.start_sdk_fun_call),!CP_UTILS.isSupportDevice())return void Oe(countly_event_id_map.device_un_support,[CP_UTILS.detectOS(),CP_UTILS.deviceType()].join(","));if(!_){if(Ie)return Oe(countly_event_id_map.start_sdk_fun_call_multi_error),void __hmLogError(null,CP_ERROR_MAP.start_sdk_fun_call_multi_error);Ie=!0}var n=CP_UTILS.getSessionStore("game_options");n&&n.pkg_name&&e.pkg_name!==n.pkg_name&&v("",V,!1),CP_UTILS.setSessionStore("game_options",e),$&&(ue=CP_UTILS.getSessionStore("cloud_cidinfo"),K||(ue||Oe(countly_event_id_map.start_sdk),ue&&(ee=!0),CP_showLoadingView("startSDK"),d(e.userinfo,e.configinfo,e.pkg_name,e.c_token,function(e){return e}),_e=!1))}function N(e){var _=SAAS_AUTH,n={cid:e,envType:envType};Oe(countly_event_id_map.stop_clound_service_start),s(_,CP_CONSTANT.API_ACTION_STOP_CLOUD_SERVICE,n,function(e){0===e.code?Oe(countly_event_id_map.stop_clound_service_succeed):(__hmLogWarn(null,CP_ERROR_MAP.stop_cloud_service,e.code),a(CP_CONSTANT.API_ACTION_STOP_CLOUD_SERVICE,e.code))})}function A(e){var _={interval:(Date.now()-J)/1e3,reason:e};w.emit("cp.sceneChanged","stop",_)}function v(e,_,n,t){Oe(countly_event_id_map.stop_sdk_fun_Call,n?0:1),w.off(CP_CONSTANT.EVENT_PLAYER_ERROR),K=_;var o=CP_UTILS.getSessionStore("cloud_cidinfo");if(ne=null,ie=null,re=null,ae=-1,te=!1,ve&&(clearInterval(ve),ve=null),Ae&&(clearInterval(Ae),Ae=null),CP_UTILS.isWebsocketObject(Ce)&&(CP_UTILS.websocket_close(Ce,!0),Ce=void 0,Oe(countly_event_id_map.saas_socket_closed,countly_event_custom_error.socket_close_by_self)),CP_hideLoadingView(),U?U.stop(e):e&&m(e),t&&A(t),K!=x){var i=o&&o.cid?o.cid+"":null,r=fe();i&&r.hasOwnProperty(i)&&(delete r[i],localStorage.cloudplay_cids=JSON.stringify(r)),i&&(N(o.cid),_===G?CP_UTILS.setSessionStore("cloud_cidinfo",null):sessionStorage.removeItem("CLOUDPLAY"))}}function f(){if(ie=null,re=null,te&&ne){if(!U)return;w.off(CP_CONSTANT.EVENT_PLAYER_ERROR).on(CP_CONSTANT.EVENT_PLAYER_ERROR,function(){K||w.emit("cp.reconnect",CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_REFRESH_TOKEN)});try{var e=ne.resolutionInfo.resolution,_=e.indexOf("x");ne.vedioWidth=parseInt(e.substring(0,_)),ne.vedioHeight=parseInt(e.substring(_+1))}catch(n){return __hmLogError(null,CP_ERROR_MAP.invalid_resolution_info,JSON.stringify(ne)),void v("游戏分辨率参数非法",V,!1,CP_CONSTANT.CP_STOP_REASON.internal_error)}U.hideMessageView(),U.startPlay(ne)}}function m(e,_){ie=null,re=null,ne=null,U?U.showMessageView(CP_CONSTANT.UI_MESSAGE_TYPE_SYSTEM,e):_&&(ie=e)}function E(e){if(!j)return void v(F.toast_wait_tooMany,V,!1,CP_CONSTANT.CP_STOP_REASON.queue_limit);if(ie=null,re=null,ne=null,U){var _=function(){Oe(countly_event_id_map.user_continue);var e=CP_UTILS.getSessionStore("cloud_cidinfo");e?(w.emit("cp.sceneChanged","wait"),l(e,1)):m("排队信息丢失,请刷新重试")},n=function(){D.sendCountly(countly_event_id_map.out_queue),v("",V,!1,CP_CONSTANT.CP_STOP_REASON.unqueue)};U.askQueuing(e,_,n),w.emit("cp.sceneChanged","askn")}else re=e}function I(e){U&&U.showWarnToast(e)}function g(e){if(!Ce)return void __hmLogWarn(null,CP_ERROR_MAP.send_pay_msg_failed);var _={uid:e.uid,to:e.from,from:e.to,mid:"W"+Date.now(),type:1,ack:0,payload:e.payload};CP_UTILS.websocket_send(Ce,"Message",_)}function y(){var e=F.prompt_game_over?F.prompt_game_over:"游戏结束, 感谢使用";v(e,V,!0)}function R(){U&&U.stopPlay(!0)}function h(){R(),Oe(countly_event_id_map.page_closed,"unload"),D.forceSendCountlyEventWhenClosed("unload")}function L(){if(U)return void __hmLogError(null,CP_ERROR_MAP.async_load_finished_multi_call);try{U=CP_CloudplayUIInit(jQuery)}catch(e){return void setTimeout(function(){L()},1e3)}return Oe(countly_event_id_map.async_load_finished),se&&U.setAuthData(se,F,q,B),CP_UTILS.isSupportDevice()?(ae!=-1&&(U.setCurrentResId(ae),ae=-1),ne?(U.connectInputSocket(ne.inputUrl,ne.inputProtocol),void f()):ie?void m(ie):re?void E(re):void 0):(v("",V,!1,CP_CONSTANT.CP_STOP_REASON.unsupport_device),void U.showMessageView(CP_CONSTANT.UI_MESSAGE_TYPE_UNSUPPORT))}function k(){Oe(countly_event_id_map.start_async_load);var e=CP_UTILS.getBasePath("saas-sdk.js");if(!ge){ge=!0;var _=[e+"jquery-3.1.0.js",e+"saas-player.js",e+"saas-ui.js"];CP_AsyncLoadJsFiles(_,!0,!0,function(e){e&&L()})}}window.SDK_VERSION="feature-mobile_h5_sdk-8c439f9f";var U=null,w=new HM_EventEmitter,D=CP_CountlyInit(w),b=!0;Date.now||(Date.now=function(){return(new Date).valueOf()});var M=0,V=1,G=2,x=3,K=M,Y=CP_UTILS.clientType();if("object"==typeof localStorage)try{localStorage.setItem("localStorage",1),localStorage.removeItem("localStorage")}catch(H){setTimeout(function(){v('不能在"无痕模式"下进行游戏',V,!1,CP_CONSTANT.CP_STOP_REASON.unsupport_privated_mode)},3e3)}var j=!CP_UTILS.isMobile(),J=0,F={},q={},W=CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_NORMAL,B={},Q="web0123456789012",z="3.0.11",X=5,Z=5,$=!1,ee=!1,_e=!1,ne=null,te=!1,oe=!1,ie=null,re=null,ae=-1,se=null,ce=void 0,de="",le="",ue=void 0,Ce=void 0,Te="网络异常，请重新连接",Se=localStorage.cloud_did;if(CP_UTILS.isMobile()){window.onorientationchange=function(){var e=CP_UTILS.orientation();w.emit(CP_CONSTANT.EVENT_ORIENTATION_CHANGE,e)};var Pe=0;document.addEventListener("visibilitychange",function(){if(K!=V&&K!=G&&CP_UTILS.detectOS()==CP_CONSTANT.OS_IPHONE)if("visible"==document.visibilityState){K=M;var e=Pe>0&&(new Date).getTime()-Pe<3e4;e||Ee||CP_UTILS.setSessionStore("cloud_cidinfo",null),CP_showLoadingView(),setTimeout(function(){w.emit("cp.reconnect",e?CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_REFRESH_TOKEN:CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_NORMAL)},1e3),Pe=0}else te&&(Pe=(new Date).getTime()),v("",x,!1)})}CP_UTILS.onNetworkStatus(function(e){b=e,K!=V&&K!=G&&(b===!0?window.location.reload():v("连接出错,联网后会自动重连",x,!1,CP_CONSTANT.CP_STOP_REASON.disconnect))});var Oe=function(e,_){D.sendCountly(n(),de,le,e,_)},pe=!1,Ne=null,Ae=null,ve=null;w.on("cp.reg_sdk_done",function(e,_){C(_)}),w.on("cp.get_auth_config_done",function(e){var _=CP_UTILS.getSessionStore("game_options");$=!0,Ie&&e&&_&&_.pkg_name===e&&p(_,!0)});var fe=function(){try{var e=JSON.parse(localStorage.cloudplay_cids);return e?e:{}}catch(_){return{}}};w.on("cp.get_cid_done",function(_){if(CP_UTILS.setSessionStore("cloud_cidinfo",_),_.cid){var n=fe();n[_.cid]=_.secret_key,localStorage.cloudplay_cids=JSON.stringify(n)}if(CP_UTILS.isWebsocketObject(Ce)){if(Ce.readyState==e.OPEN)return Oe(countly_event_id_map.saas_socket_already_opened),void Ce.onopen();Oe(countly_event_id_map.saas_socket_close_pre,Ce.readyState),Ae&&(clearInterval(Ae),Ae=null),CP_UTILS.websocket_close(Ce,!0),Ce=void 0}P(_.saas_ws,_)}),w.on("cp.network_status_change",function(e){e===!0?w.emit("cp.reconnect",CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_REFRESH_TOKEN):(A(CP_CONSTANT.CP_STOP_REASON.disconnect),m("连接出错,联网后会自动重连"))}),w.on("cp.cloud_service_ready",function(e){te=!0,ue=CP_UTILS.getSessionStore("cloud_cidinfo"),ue&&(ue.start_timestamp?J=ue.start_timestamp:(J=Date.now(),ue.start_timestamp=J,CP_UTILS.setSessionStore("cloud_cidinfo",ue)),ae=-1,U?U.setCurrentResId(e):ae=e,f())});var me=0,Ee=!1;w.on("cp.reconnect",function(e){if(void 0!=e&&e!=-1&&(W=e),me++,me>Z)return void v("尝试重新连接次数超过上限",V,!1,CP_CONSTANT.CP_STOP_REASON.internal_error);if(Oe(countly_event_id_map.reconnecting,[K,Ee].join(",")),ne=null,ie=null,re=null,ae=-1,te=!1,_e=!1,K)return void I("云玩已关闭");if(Ee)return void I("正在连接中");if(b){Ee=!0,U&&U.stopPlay(!1),CP_showLoadingView();var _=CP_UTILS.getSessionStore("game_options");u(_.pkg_name)}}),w.on("cp.get_rtmp_addr",function(e){me=0,ne=e,ne.inputProtocol="haima-cloud-protocol",U&&U.connectInputSocket(ne.inputUrl,ne.inputProtocol),f()});var Ie=!1;w.on(CP_CONSTANT.EVENT_STOP_SDK,function(e,_){v(e,V,!1,_?_:CP_CONSTANT.CP_STOP_REASON.internal)}),w.on(CP_CONSTANT.EVENT_PLAYER_READY,function(){CP_hideLoadingView()}),w.on(CP_CONSTANT.EVENT_REFRESH_PAGE_REQUIRE,function(){v("",x,!1,CP_CONSTANT.CP_STOP_REASON.need_refresh_page),U.showMessageView(CP_CONSTANT.UI_MESSAGE_TYPE_REFRESH_REQUIRED,"游戏中断,点击刷新页面并继续游戏")});var ge=!1;return setTimeout(function(){CP_UTILS.hasOwnProperty(window,"__ASYNC_LOAD")?k():L()},50),{initSDK:S,startSDK:p,stopSDK:y,sendPayMessage:g,isStoped:function(){return K},isReconnecting:function(){return Ee},isFirstConnect:function(){return!ee},eventEmitter:function(){return w},sendCountly:Oe,_onbeforeunload:R,_onunload:h,testReconnect:function(){w.emit("cp.reconnect",CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_REFRESH_TOKEN)}}}(WebSocket||{},CryptoJS||{});window.onbeforeunload=Cloudplay._onbeforeunload,window.onunload=Cloudplay._onunload;