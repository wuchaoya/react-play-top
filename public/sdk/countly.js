!function(e){"use strict";function t(t){if(!e.app_key)return void a("app_key or device_id is missing");t.app_key=e.app_key,t.device_id=e.device_id,t.sdk_name=v,t.sdk_version=g,e.country_code&&(t.country_code=e.country_code),e.city&&(t.city=e.city),null!==e.ip_address&&(t.ip_address=e.ip_address),t.timestamp=c();var n=new Date;t.hour=n.getHours(),t.dow=n.getDay(),x.length>w&&x.shift(),x.push(t),G("cly_queue",x,!0)}function n(){if("undefined"!=typeof e.q&&e.q.length>0){for(var r,o=0;o<e.q.length;o++)if(r=e.q[o],a("Processing queued call",r),"function"==typeof r)r();else if(r.constructor===Array&&r.length>0)if("undefined"!=typeof e[r[0]])e[r[0]].apply(null,r.slice(1));else{var i=r[0].replace("userData.","");"undefined"!=typeof e.userData[i]&&e.userData[i].apply(null,r.slice(1))}e.q=[]}if(b.length>0){if(b.length<=A)t({events:JSON.stringify(b)}),b=[];else{var c=b.splice(0,A);t({events:JSON.stringify(c)})}G("cly_event",b)}if(x.length>0&&E&&u()>C){E=!1;var s=x.shift();a("Processing request",s),$.sendCount+=1,d(s,function(e,t){a("Request Finished",t,e),e?($.sendFailedCount+=1,x.unshift(t),C=u()+M):$.sendSucceedCount+=1,G("cly_queue",x,!0),E=!0})}setTimeout(n,h)}function r(){return G("cly_id")||o()}function o(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)});return t}function i(){var t={};if(t._app_version=e.app_version,t._ua=navigator.userAgent,screen.width){var n=screen.width?parseInt(screen.width):0,r=screen.height?parseInt(screen.height):0;if(0!==n&&0!==r){var o=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform);if(o&&window.devicePixelRatio)n=Math.round(n*window.devicePixelRatio),r=Math.round(r*window.devicePixelRatio);else if(90===Math.abs(window.orientation)){var i=n;n=r,r=i}t._resolution=""+n+"x"+r}}window.devicePixelRatio&&(t._density=window.devicePixelRatio);var u=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;if("undefined"!=typeof u&&(t._locale=u),"undefined"!=typeof document.referrer&&document.referrer.length){var c=I.exec(document.referrer);if(c&&c[11]&&c[11]!=window.location.hostname){var s=!1;if(T&&T.length)for(var d=0;d<T.length;d++)try{var l=new RegExp(T[d]);if(l.test(document.referrer)){a("Ignored:",document.referrer),s=!0;break}}catch(f){}s||(t._store=document.referrer)}}return a("Got metrics",t),t}function a(){try{e.debug&&"undefined"!=typeof console&&(arguments[1]&&"object"==typeof arguments[1]&&(arguments[1]=JSON.stringify(arguments[1])),console.log(Array.prototype.slice.call(arguments).join("\n")))}catch(t){}}function u(){return Math.floor((new Date).getTime()/1e3)}function c(){var e=(new Date).getTime();return O>=e?O++:O=e,O}function s(e,n,r){if(e){r=r||q;var o="";"object"==typeof e?"undefined"!=typeof e.stack?o=e.stack:("undefined"!=typeof e.name&&(o+=e.name+":"),"undefined"!=typeof e.message&&(o+=e.message+"\n"),"undefined"!=typeof e.fileName&&(o+="in "+e.fileName+"\n"),"undefined"!=typeof e.lineNumber&&(o+="on "+e.lineNumber),"undefined"!=typeof e.columnNumber&&(o+=":"+e.columnNumber)):o=e+"",n=!!n;var a=i(),c={_resolution:a._resolution,_error:o,_app_version:a._app_version,_run:u()-y};c._not_os_specific=!0;var s=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery;s&&(c._bat=Math.floor(100*s.level)),"undefined"!=typeof navigator.onLine&&(c._online=!!navigator.onLine),c._background=!document.hasFocus(),S.length>0&&(c._logs=S.join("\n")),S=[],c._nonfatal=n,c._view=(window.location.pathname||"")+(window.location.search||"")+(window.location.hash||""),"undefined"!=typeof r&&(c._custom=r);try{var d=document.createElement("canvas"),l=d.getContext("experimental-webgl");c._opengl=l.getParameter(l.VERSION)}catch(f){}t({crash:JSON.stringify(c)})}}function d(t,n){try{a("Sending XML HTTP request");var r=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null,o=l(t),i="GET";o.length>=2e3?i="POST":e.force_post&&(i="POST"),"GET"===i?r.open("GET",e.url+m+"?"+o,!0):(r.open("POST",e.url+m,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded")),r.onreadystatechange=function(){4===this.readyState&&this.status>=200&&this.status<300?"function"==typeof n&&n(!1,t):4===this.readyState&&(a("Failed Server XML HTTP request",this.status),"function"==typeof n&&n(!0,t))},"GET"==i?r.send():r.send(o)}catch(u){a("Failed XML HTTP request",u),"function"==typeof n&&n(!0,t)}}function l(e){var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")}function f(e){return"/"==e.substr(e.length-1)?e.substr(0,e.length-1):e}function p(e,t){for(var n,r={},o=0;o<t.length;o++)n=t[o],"undefined"!=typeof e[n]&&(r[n]=e[n]);return r}var y,g="16.12",v="javascript_native_web",_=!1,m="/i",h=500,w=1e3,x=[],b=[],S=[],k={},T=[],q=null,C=0,M=60,P=20,N=60,A=10,O=0,E=!0,I=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,D=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO)/,L=!1,R=null,$={url:"",sendCount:0,sendSucceedCount:0,sendFailedCount:0};e.init=function(t){if(!_){try{window.console&&window.console.info&&(R=window.console.info),R&&R("cly v1.4")}catch(o){R=null}if(y=u(),_=!0,x=G("cly_queue")||[],k={},b=G("cly_event")||[],t=t||{},h=t.interval||e.interval||h,w=t.queue_size||e.queue_size||w,M=t.fail_timeout||e.fail_timeout||M,P=t.inactivity_time||e.inactivity_time||P,N=t.session_update||e.session_update||N,A=t.max_events||e.max_events||A,e.ignore_prefetch=t.ignore_prefetch||e.ignore_prefetch||!0,e.debug=t.debug||e.debug||!1,e.app_key=t.app_key||e.app_key||null,e.device_id=t.device_id||e.device_id||r(),e.url=f(t.url||e.url||""),e.app_version=t.app_version||e.app_version||"0.0",e.country_code=t.country_code||e.country_code||null,e.city=t.city||e.city||null,e.ip_address=t.ip_address||e.ip_address||null,e.ignore_bots=t.ignore_bots||e.ignore_bots||!0,e.force_post=t.force_post||e.force_post||!1,e.q=e.q||[],t.ignore_referrers&&t.ignore_referrers.constructor===Array?T=t.ignore_referrers:e.ignore_referrers&&e.ignore_referrers.constructor===Array&&(T=e.ignore_referrers),""===e.url&&(a("Please provide server URL"),L=!0),e.ignore_prefetch&&"undefined"!=typeof document.visibilityState&&"prerender"===document.visibilityState&&(L=!0),e.ignore_bots&&D.test(navigator.userAgent)&&(L=!0),L=!1,!L&&(a("Countly initialized"),e.q.constructor!==Array&&(e.q=[]),n(),G("cly_id",e.device_id),location.search))for(var i=location.search.substring(1).split("&"),c=0;c<i.length;c++){var s=i[c].split("=");"cly_id"==s[0]?G("cly_cmp_id",s[1]):"cly_uid"==s[0]&&G("cly_cmp_uid",s[1])}}},e.add_event=function(e){if(!e.key)return void a("Event must have key property");e.count||(e.count=1);var t=["key","count","sum","dur","segmentation"],n=p(e,t);n.timestamp=c();var r=new Date;n.hour=r.getHours(),n.dow=r.getDay(),b.push(n),G("cly_event",b),a("Adding event: ",e)},e.start_event=function(e){return k[e]?void a("Timed event with key "+e+" already started"):void(k[e]=u())},e.end_event=function(t){return"string"==typeof t&&(t={key:t}),t.key?k[t.key]?(t.dur=u()-k[t.key],e.add_event(t),void delete k[t.key]):void a("Timed event with key "+t.key+" was not started"):void a("Event must have key property")},e.user_details=function(e){a("Adding userdetails: ",e);var n=["name","username","email","organization","phone","picture","gender","byear","custom"];t({user_details:JSON.stringify(p(e,n))})},e.report_conversion=function(e,n){e=e||G("cly_cmp_id")||"cly_organic",n=n||G("cly_cmp_uid"),e&&n?t({campaign_id:e,campaign_user:n}):e?t({campaign_id:e}):a("No campaign data found")};var B={},j=function(e,t,n){B[e]||(B[e]={}),"$push"==n||"$pull"==n||"$addToSet"==n?(B[e][n]||(B[e][n]=[]),B[e][n].push(t)):B[e][n]=t};e.userData={set:function(e,t){B[e]=t},set_once:function(e,t){j(e,1,"$setOnce")},increment:function(e){j(e,1,"$inc")},increment_by:function(e,t){j(e,t,"$inc")},multiply:function(e,t){j(e,t,"$mul")},max:function(e,t){j(e,t,"$max")},min:function(e,t){j(e,t,"$min")},push:function(e,t){j(e,t,"$push")},push_unique:function(e,t){j(e,t,"$addToSet")},pull:function(e,t){j(e,t,"$pull")},save:function(){t({user_details:JSON.stringify({custom:B})}),B={}}},e.track_errors=function(e){q=e,window.onerror=function(e,t,n,r,o){if("undefined"!=typeof o)s(o,!1);else{r=r||window.event&&window.event.errorCharacter;var i="";"undefined"!=typeof e&&(i+=e+"\n"),"undefined"!=typeof t&&(i+="at "+t),"undefined"!=typeof n&&(i+=":"+n),"undefined"!=typeof r&&(i+=":"+r),i+="\n";try{for(var a=[],u=arguments.callee.caller;u;)a.push(u.name),u=u.caller;i+=a.join("\n")}catch(c){}s(i,!1)}}},e.log_error=function(e,t){s(e,!0,t)},e.add_log=function(e){S.push(e)},e.getStatisticsInfo=function(){return $.url=e.url,$},e.forceSendCountlyEvent=function(){var e=A;A=e<50?50:e,E=!0,C=0;try{for(n();x.length>0;){var t=x.shift();d(t,function(e,t){})}}catch(r){R&&R("forceSendCountlyEvent got error: "+r.toString())}A=e},Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;for(e=e.toUpperCase();t;){if(t.nodeName.toUpperCase()==e)return t;t=t.parentElement}});var G=function(e,t,n){function r(e,t,n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3);var o="; expires="+r.toGMTString();document.cookie=e+"="+t+o+"; path=/"}function o(e){for(var t=e+"=",n=document.cookie.split(";"),r=0,o=n.length;r<o;r++){for(var i=n[r];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null}n=n||!1;var i,a=!1;if("undefined"!=typeof localStorage){a=!0;try{localStorage.setItem("testLocal",!0)}catch(u){a=!1}}if("undefined"!=typeof t&&null!==t)if("object"==typeof t&&(t=JSON.stringify(t)),a)try{localStorage.setItem(e,t)}catch(u){R&&R("setItem got error: "+u.toString()),localStorage.removeItem("cly_queue"),localStorage.removeItem("cly_event")}else n||r(e,t,30);if("undefined"==typeof t){a?i=localStorage.getItem(e):n||(i=o(e));try{i=JSON.parse(i)}catch(u){i=i}return i}null===t&&(a?localStorage.removeItem(e):n||r(e,"",-1))}}(window.Countly=window.Countly||{});